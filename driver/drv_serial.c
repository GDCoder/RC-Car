/***************************************************************************
	(C)Copyright Logic Inc. 2008, Logic all rights reserved.

	Product	: STC MCU Firmware
	Date		: 2009.03.26
	Purpose	: 
	Sources	: drv_serial.c
***************************************************************************/

//Modification use :
/***************************************************************************
	Update

	Date  	: 2009.03.26
	Name	: Logic
	Description	: 

	Item			                  Source
	----------------------------------------		-------------------
	. create 					            drv_serial.c
***************************************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stc15.h>
#include "drv_serial.h"

#ifdef SERIAL_ENABLE
/*****************************************************************************
 Constants   宏定义
*****************************************************************************/
#define TIMER_START			1
#define TIMER_STOP			0

#define SERIAL_MODE			0x40		//定义串口工作在10位Uart方式下(方式1)，波特率可变，不允许接收
#define TIMER1_MODE			0x20		//定义定时器1为8位定时模式，自动重装初值
#define BAUD_RATE_MODE		0X80		//定义波特率倍增模式
#define BAUD_RATE_VALUE		0xF3		//定义波特率对应的定时器初值 	4800

/*****************************************************************************
 Struct
*****************************************************************************/


/*****************************************************************************
 Global Data
*****************************************************************************/


/*****************************************************************************
 Extern functions
*****************************************************************************/


/*****************************************************************************
 Local variables 
*****************************************************************************/


/*****************************************************************************
 Local functions
*****************************************************************************/


/*****************************************************************************
 implement begin 
*****************************************************************************/
void DRV_Serial_Init(void)
{
	//停止Timer1计数
	TR1 = TIMER_STOP;

	//定义串口工作方式
	SCON |= SERIAL_MODE;

	//定义定时器1工作方式
	TMOD |= TIMER1_MODE;

	//定义定时器1波特率倍增
	PCON |= BAUD_RATE_MODE;

	//定义定时器0初值
	TH1 = BAUD_RATE_VALUE;
	TL1 = BAUD_RATE_VALUE;

	//允许发送并开始Timer1计数
	TI = 1;
	TR1 = TIMER_START;
}

/*****************************************************************************/
#endif	//SERIAL_ENABLE


